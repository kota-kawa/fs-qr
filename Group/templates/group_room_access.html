{% extends "group_layout.html" %}

{% block page_title %}ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ | FS!QR Group - ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰{% endblock %}

{% block meta_description %}FS!QR Groupã®ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ãƒ«ãƒ¼ãƒ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ä½œæˆã¨å‚åŠ ã®ä¸¡æ–¹ãŒå¯èƒ½ã€‚è¤‡æ•°äººã§å®‰å…¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ãƒ»ç®¡ç†ã§ãã‚‹ãƒãƒ¼ãƒ å”æ¥­ãƒ„ãƒ¼ãƒ«ã€‚{% endblock %}

{% block meta_keywords %}ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹, ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰, ã‚°ãƒ«ãƒ¼ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†, ãƒ«ãƒ¼ãƒ å‚åŠ , ä¼æ¥­ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰, ãƒãƒ¼ãƒ å”æ¥­, FS QR Group{% endblock %}

{% block og_title %}ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ | FS!QR Group - ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰{% endblock %}

{% block og_description %}FS!QR Groupã®ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ãƒ«ãƒ¼ãƒ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ä½œæˆã¨å‚åŠ ã®ä¸¡æ–¹ãŒå¯èƒ½ã€‚è¤‡æ•°äººã§å®‰å…¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ãƒ»ç®¡ç†ã§ãã‚‹ãƒãƒ¼ãƒ å”æ¥­ãƒ„ãƒ¼ãƒ«ã€‚{% endblock %}

{% block twitter_title %}ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ | FS!QR Group{% endblock %}

{% block twitter_description %}ãƒãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ãƒ«ãƒ¼ãƒ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ ä½œæˆã¨å‚åŠ ã®ä¸¡æ–¹ãŒå¯èƒ½ã§ã€è¤‡æ•°äººã§å®‰å…¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ãƒ»ç®¡ç†ã§ãã¾ã™ã€‚{% endblock %}

{% block contents %}
<div style="padding: 2rem; max-width: 900px; margin: 0 auto;">
    <div style="background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: visible; margin-bottom: 2rem;">
        <!-- Header -->
        <div style="background: linear-gradient(135deg, rgb(22, 101, 52) 0%, rgb(34, 197, 94) 100%); color: white; padding: 2rem; text-align: center;">
            <h1 style="margin: 0; font-size: 1.75rem;">ğŸ“‚ ã‚°ãƒ«ãƒ¼ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰</h1>
        </div>
        
        <!-- Body -->
        <div style="padding: 2rem;">
            <!-- Access Form Section -->
            <div style="background: #f9fafb; border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem;">
                <h3 style="margin-top: 0; color: #374151;">ãƒ«ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹</h3>
                
                <!-- Tab Buttons -->
                <div style="display: flex; background: #e5e7eb; border-radius: 8px; margin-bottom: 1rem;">
                    <button type="button" onclick="switchTab('join')" id="join-btn" style="flex: 1; padding: 0.75rem; background: rgb(34, 197, 94); color: white; border: none; border-radius: 8px 0 0 8px; cursor: pointer; font-weight: 600;">
                        ãƒ«ãƒ¼ãƒ ã«å‚åŠ 
                    </button>
                    <button type="button" onclick="switchTab('create')" id="create-btn" style="flex: 1; padding: 0.75rem; background: #e5e7eb; color: #6b7280; border: none; border-radius: 0 8px 8px 0; cursor: pointer; font-weight: 600;">
                        æ–°è¦ãƒ«ãƒ¼ãƒ ä½œæˆ
                    </button>
                </div>
                
                <!-- Join Form -->
                <div id="join-tab">
                    <form method="POST" action="/search_group_process">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Room ID</label>
                            <input type="text" name="id" placeholder="ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›" required 
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                            <input type="password" name="password" placeholder="6æ¡ã®æ•°å­—" required 
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <button type="submit" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, rgb(22, 101, 52) 0%, rgb(34, 197, 94) 100%); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                            ğŸ” ãƒ«ãƒ¼ãƒ ã«å‚åŠ 
                        </button>
                    </form>
                </div>
                
                <!-- Create Form -->
                <div id="create-tab" style="display: none;">
                    <form method="POST" action="/create_group_room">
                        <!-- IDå…¥åŠ›æ–¹å¼é¸æŠ -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ãƒ«ãƒ¼ãƒ IDè¨­å®šæ–¹å¼</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="idMode" value="auto" checked style="margin-right: 5px;">
                                    è‡ªå‹•ç”Ÿæˆ
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="idMode" value="manual" style="margin-right: 5px;">
                                    æ‰‹å‹•å…¥åŠ›
                                </label>
                            </div>
                        </div>
                        
                        <!-- IDå…¥åŠ›æ¬„ï¼ˆæ‰‹å‹•ï¼‰ -->
                        <div id="manualIdGroup" style="display: none; margin-bottom: 1rem;">
                            <label for="roomID" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Room ID</label>
                            <input type="text" id="roomID" name="id" placeholder="6æ–‡å­—ã®åŠè§’è‹±æ•°å­—ã§å…¥åŠ›"
                                   minlength="6" maxlength="6" pattern="[a-zA-Z0-9]{6}"
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;"
                                   title="6æ–‡å­—ã®åŠè§’è‹±æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„">
                        </div>
                        
                        <!-- è‡ªå‹•ç”ŸæˆIDè¡¨ç¤º -->
                        <div id="autoIdGroup" style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ID</label>
                            <input type="text" id="autoGeneratedId" readonly
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; background-color: #f0f0f0;"
                                   placeholder="è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™">
                            <input type="hidden" id="hiddenId" name="id">
                        </div>

                        <div style="margin-bottom: 1.25rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;" for="retention">è‡ªå‹•å‰Šé™¤ã¾ã§ã®æœŸé–“</label>
                            <div class="retention-select-wrapper retention-select-wrapper--emerald" data-retention-select>
                                <select id="retention" name="retention_days" class="retention-select" autocomplete="off">
                                    <option value="1">1æ—¥</option>
                                    <option value="7" selected>7æ—¥ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)</option>
                                    <option value="30">30æ—¥ (ç´„1ã‹æœˆ)</option>
                                </select>
                                <span class="retention-select-arrow" aria-hidden="true">
                                    <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </span>
                            </div>
                            <small class="retention-select-hint">é¸æŠã—ãŸä¿å­˜æœŸé–“ã®çµŒéå¾Œã€è‡ªå‹•ã§å®‰å…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚</small>
                        </div>

                        <button type="submit" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, rgb(22, 101, 52) 0%, rgb(34, 197, 94) 100%); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                            ğŸš€ ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆ
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Demo Upload Area -->
            <div style="background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%); border: 3px dashed #d1d5db; border-radius: 16px; padding: 2rem; text-align: center; margin-bottom: 2rem; opacity: 0.7;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">â˜ï¸</div>
                <p style="font-size: 1.1rem; color: #6b7280; margin-bottom: 1rem; line-height: 1.6;">
                    ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ<br>
                    <small style="color: #9ca3af;">(ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆãƒ»å‚åŠ ã™ã‚‹ã¨åˆ©ç”¨ã§ãã¾ã™)</small>
                </p>
                <button disabled style="padding: 0.75rem 1.5rem; background: #d1d5db; color: #6b7280; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: not-allowed;">
                    ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆãƒ‡ãƒ¢ï¼‰
                </button>
            </div>
            
            <!-- Demo File Lists -->
            <div style="margin-bottom: 2rem;">
                <h5 style="color: #374151; margin-bottom: 1rem;">ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾…ã¡ãƒ•ã‚¡ã‚¤ãƒ«</h5>
                <div style="background: #f9fafb; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; min-height: 80px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                        <span>ğŸ“„ example-document.pdf</span>
                        <span style="color: #6b7280; font-size: 0.9rem;">å¾…æ©Ÿä¸­</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                        <span>ğŸ–¼ï¸ sample-image.jpg</span>
                        <span style="color: #6b7280; font-size: 0.9rem;">å¾…æ©Ÿä¸­</span>
                    </div>
                </div>
                <button disabled style="padding: 0.75rem 1.5rem; background: #d1d5db; color: #6b7280; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: not-allowed;">
                    ğŸš€ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¢ï¼‰
                </button>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <h5 style="color: #374151; margin-bottom: 1rem;">ğŸ“¥ ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ« (2)</h5>
                <div style="background: #f9fafb; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; min-height: 80px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                        <span>ğŸ“‹ meeting-notes.txt</span>
                        <span style="color: #6b7280; font-size: 0.9rem;">ãƒ‡ãƒ¢ãƒ•ã‚¡ã‚¤ãƒ«</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                        <span>ğŸ“Š data-report.xlsx</span>
                        <span style="color: #6b7280; font-size: 0.9rem;">ãƒ‡ãƒ¢ãƒ•ã‚¡ã‚¤ãƒ«</span>
                    </div>
                </div>
                <button disabled style="padding: 0.75rem 1.5rem; background: #d1d5db; color: #6b7280; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: not-allowed;">
                    ğŸ“¦ ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¢ï¼‰
                </button>
            </div>
        </div>
    </div>
    
    <!-- Usage Section -->
    <div style="background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: visible;">
        <div style="background: linear-gradient(135deg, rgb(22, 101, 52) 0%, rgb(34, 197, 94) 100%); color: white; padding: 1.5rem; text-align: center;">
            <h5 style="margin: 0;">ä½¿ã„æ–¹</h5>
        </div>
        <div style="padding: 2rem;">
            <p style="margin: 0; line-height: 1.6;">
                ã“ã®ãƒ«ãƒ¼ãƒ ã§ã¯ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚<br>
                ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã¾ãŸã¯å‚åŠ ã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
                ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ ã—ã€ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã§é€ä¿¡ã—ã¾ã™ã€‚<br>
                ä»–ã®äººã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸‹ã®ãƒªã‚¹ãƒˆã‹ã‚‰å€‹åˆ¥ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„å‰Šé™¤ãŒã§ãã¾ã™ã€‚
            </p>
        </div>
    </div>
</div>

<!-- Spinner overlay -->
<div id="spinner-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 9999;">
    <div style="text-align: center;">
        <div style="width: 60px; height: 60px; border: 6px solid #f3f3f3; border-top: 6px solid rgb(34, 197, 94); border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <div style="margin-top: 1rem; color: white; font-size: 1.1rem;">å‡¦ç†ä¸­...</div>
    </div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// Define functions immediately to make them available for onclick handlers
function switchTab(tabName) {
    // Hide all tabs
    document.getElementById('join-tab').style.display = 'none';
    document.getElementById('create-tab').style.display = 'none';
    
    // Reset button styles
    document.getElementById('join-btn').style.background = '#e5e7eb';
    document.getElementById('join-btn').style.color = '#6b7280';
    document.getElementById('create-btn').style.background = '#e5e7eb';
    document.getElementById('create-btn').style.color = '#6b7280';
    
    // Show selected tab and highlight button
    if (tabName === 'join') {
        document.getElementById('join-tab').style.display = 'block';
        document.getElementById('join-btn').style.background = 'rgb(34, 197, 94)';
        document.getElementById('join-btn').style.color = 'white';
    } else {
        document.getElementById('create-tab').style.display = 'block';
        document.getElementById('create-btn').style.background = 'rgb(34, 197, 94)';
        document.getElementById('create-btn').style.color = 'white';
    }
}

function showSpinner() {
    document.getElementById('spinner-overlay').style.display = 'flex';
}

function hideSpinner() {
    document.getElementById('spinner-overlay').style.display = 'none';
}

// IDç”Ÿæˆé–¢æ•°
function generateRandomId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 6; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

// Ensure spinner is hidden on page load
document.addEventListener('DOMContentLoaded', function() {
    hideSpinner();
    
    // Add form submission handlers
    document.querySelector('#join-tab form').addEventListener('submit', function(e) {
        e.preventDefault();
        showSpinner();
        this.submit();
    });
    
    document.querySelector('#create-tab form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = this;
        const formData = new FormData(form);
        
        showSpinner();
        
        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.redirected) {
                // æˆåŠŸæ™‚ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = response.url;
            } else if (response.status === 409) {
                // IDã®é‡è¤‡ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
                return response.json().then(data => {
                    if (data.retry_auto) {
                        // è‡ªå‹•ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã§ã®é‡è¤‡ã®å ´åˆã€æ–°ã—ã„IDã§è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
                        const newId = generateRandomId();
                        document.getElementById('autoGeneratedId').value = newId;
                        document.getElementById('hiddenId').value = newId;
                        
                        // æ–°ã—ã„IDã§å†é€ä¿¡
                        const newFormData = new FormData(form);
                        newFormData.set('id', newId);
                        
                        return fetch(form.action, {
                            method: 'POST',
                            body: newFormData
                        });
                    } else {
                        // æ‰‹å‹•å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
                        hideSpinner();
                        alert(data.error);
                        return Promise.reject('Manual ID conflict');
                    }
                });
            } else if (!response.ok) {
                // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
                return response.json().then(data => {
                    hideSpinner();
                    alert(data.error || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                    throw new Error(data.error);
                });
            }
            return response;
        })
        .then(response => {
            if (response && response.redirected) {
                window.location.href = response.url;
            }
        })
        .catch(error => {
            if (error !== 'Manual ID conflict') {
                console.error('Error:', error);
                hideSpinner();
            }
        });
    });
    
    // æ–°ã—ã„IDç”Ÿæˆæ©Ÿèƒ½
    if (document.getElementById('autoGeneratedId')) {
        const autoIdInput = document.getElementById('autoGeneratedId');
        const hiddenIdInput = document.getElementById('hiddenId');
        const roomIdInput = document.getElementById('roomID');
        autoIdInput.value = generateRandomId();
        hiddenIdInput.value = autoIdInput.value;
        roomIdInput.name = '';
        hiddenIdInput.name = 'id';

        // IDå…¥åŠ›æ–¹å¼ã®åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('input[name="idMode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const manualGroup = document.getElementById('manualIdGroup');
                const autoGroup = document.getElementById('autoIdGroup');
                const hiddenIdInput = document.getElementById('hiddenId');
                
                if (this.value === 'manual') {
                    manualGroup.style.display = 'block';
                    autoGroup.style.display = 'none';
                    roomIdInput.required = true;
                    hiddenIdInput.name = ''; // hidden fieldã‚’ç„¡åŠ¹åŒ–
                    roomIdInput.name = 'id'; // manual inputã‚’æœ‰åŠ¹åŒ–
                } else {
                    manualGroup.style.display = 'none';
                    autoGroup.style.display = 'block';
                    roomIdInput.required = false;
                    roomIdInput.name = ''; // manual inputã‚’ç„¡åŠ¹åŒ–
                    hiddenIdInput.name = 'id'; // hidden fieldã‚’æœ‰åŠ¹åŒ–
                    // æ–°ã—ã„IDã‚’ç”Ÿæˆ
                    const newId = generateRandomId();
                    document.getElementById('autoGeneratedId').value = newId;
                    hiddenIdInput.value = newId;
                }
            });
        });
        
        // IDå…¥åŠ›æ¬„ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ‰‹å‹•å…¥åŠ›æ™‚ã®ã¿ï¼‰
        if (roomIdInput) {
            roomIdInput.addEventListener('input', function() {
                const value = this.value;
                const isValid = /^[a-zA-Z0-9]{0,6}$/.test(value);

                if (!isValid) {
                    this.setCustomValidity('åŠè§’è‹±æ•°å­—ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„');
                    this.style.borderColor = '#ef4444';
                } else if (value.length < 6 && value.length > 0) {
                    this.setCustomValidity('6æ–‡å­—ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
                    this.style.borderColor = '#f59e0b';
                } else {
                    this.setCustomValidity('');
                    this.style.borderColor = value.length === 6 ? '#10b981' : '#e5e7eb';
                }
            });
        }
    }
});

// Hide spinner if form submission fails (user navigates back)
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        hideSpinner();
    }
});
</script>
{% endblock %}